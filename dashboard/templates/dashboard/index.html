<!DOCTYPE html>
<html>
    <head>
        {% load static %}
        <link rel='stylesheet' href='{% static "css/theme.css" %}'>
        <style>
            .map {
              height: 400px;
              width: 100%;
            }
          </style>
          <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js">
            $('input[name="daterange"]').ajax({
              url: "url",
              type: "get",
              success: function(response){
              $('#blurg').html(response).fadeIn(1500);
   }
});
          </script>
          <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
          <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
          <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/build/ol.js"></script>
          <script src="https://unpkg.com/amazon-quicksight-embedding-sdk@1.18.1/dist/quicksight-embedding-js-sdk.min.js"></script>
          {% block content %}

          {%for u in url%}
          <p>{{u}}</p>
          {%endfor%}
          {% endblock %}

          <style>
          quicksight-embedding-iframe {
            background-color: transparent;
            }
            </style>
          <script type="text/javascript" >
            var startDate;
            var endDate;
            var dashboards = {
              embeddingContainerAQI: "",
              embeddingContainerComp:""
            };
            var QuickSightEmbedding = require("amazon-quicksight-embedding-sdk");
            function mainEmbed(){ 
              EmbedAQI();
              EmbedComp();
            }
            function EmbedAQI()
            {
            {% block content1 %}
            embedDashboard("{{AqiDashboard.url}}","{{AqiDashboard.con}}");
            {% endblock %}
            }
            function EmbedComp()
            {
            {% block content2 %}
            embedDashboard("{{CompDashboard.url}}","{{CompDashboard.con}}");
            {% endblock %}
            }
            function embedDashboard(url,container) {

             
  
                var containerDiv = document.getElementById(container);
                var url2 = url;
                //var url3 = url2.concat('#p.Cities=Manama&p.startdatetime=', startDate, '&p.enddatetime=', endDate);
                //document.getElementById("s").innerHTML = url3;

                var options = {
                    // replace this dummy url with the one generated via embedding API
                    url: url2.replaceAll('&amp;', '&'),
                    container: containerDiv,
                    scrolling: "no",
                    height: "AutoFit",
                    width: "1000px",
                    footerPaddingEnabled: true
                    
  
                };
                console.log(options.url);
                //dashboards.push(QuickSightEmbedding.embedDashboard(options));
                dashboards[container] = QuickSightEmbedding.embedDashboard(options);
                console.log("Embed222");
                console.log(options);
            }
  
            function test() { console.log("testttt");
          }
        </script>
      
        
        <title>Dashboard</title>
    
        
    </head>
    <body onload="mainEmbed()" >
      
      <input type="text" name="daterange" value=" " id = "date"/>
      {% load static %}
        <script>
          
        $(function() {
          $('input[name="daterange"]').daterangepicker({
            opens: 'left'
          }, function(start, end, label) {
            startDate = start.format('YYYY/MM/DD');
            endDate = end.format('YYYY/MM/DD');
            document.getElementById("s").innerHTML = startDate;
            document.getElementById("e").innerHTML = endDate;
           
            console.log(dashboards["embeddingContainerAQI"]);
            console.log(dashboards["embeddingContainerComp"]);

            //for(var dashboard of  dashboards){dashboard.setParameters({startdatetime: startDate, enddatetime: endDate});}
            //for(var dashboard of  dashboards){dashboard.setParameters({Cities: "Manama"});}
            dashboards["embeddingContainerAQI"].setParameters({Cities: "Manama", startdatetime: startDate, enddatetime: endDate});
            dashboards["embeddingContainerComp"].setParameters({Cities:[ "Manama" , "Sitra" ], startdatetime: startDate, enddatetime: endDate});

            console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
          });
        });
        </script>
    
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <a class="navbar-brand" href="#">Log out</a>
          </nav>
       <span><h5>Date picker goes here</h5></span> 
       
      
       <div id="map" class="map"></div>
       <script type="text/javascript">
        var map = new ol.Map({
          target: 'map',
          layers: [
            new ol.layer.Tile({
              source: new ol.source.OSM()
            })
          ],
          view: new ol.View({
            center: ol.proj.fromLonLat([37.41, 8.82]),
            zoom: 4
          })
        });
      </script> 
<div id="embeddingContainerAQI"></div>
<div id="embeddingContainerComp"></div>
       <div>
        
        <p id ="s"></p>
        <p id ="e"></p>

        <h5>cities table goes here</h5>
       </div>

       <div>
      
        <button onClick="buttnClick()">Click Me</button> 
        
        <script> 

        function buttnClick(){ 
	        fetch("/res",{method:'GET'}) 
	        .then((data)=>{ 
          


	        console.log("Embeded" + data) 
          
        });  
} 
</script> 
       </div> 



    </body>
</html>